select user_id, users.created_at , deals.category_id ,(quantity*unit_price)+shipping_charges as FirstPurchasePrice ,count(*) as NoOfPurchase ,sum((quantity*unit_price)+shipping_charges) as TotalPurchaseAmount, (select count(referrer_id) from users where referrer_id=deals_users.user_id) as UserReferrerl  from deals_users, deals, users  where deals_users.deal_id = deals.id and user_id = users.id group by user_id;
